{% extends 'data_capture/step.html' %}

{% block subtitle %}Validate data{% endblock %}

{% block step_body %}
<h2>Validate price list data for {{ price_list.vendor_name }}</h2>
<div>
  <h3> </h3>
  <ul class="contract-details">
    <li>Contract #<span>{{ price_list.contract_number }}</span></li>
    <li>Small business: <span>{% if price_list.is_small_business == 'True' %}Yes{% else %}No{% endif %}</span></li>
    <li>Contractor worksite: <span>{{ price_list.contractor_site }}</span></li>
    <li>Contract dates: <span>{{ price_list.contract_start }}</span> to <span>{{ price_list.contract_end }}</span></li>
    <li>Escalation rate: <span>{{ price_list.escalation_rate }}%</span></li>
    <li>Schedule: <span>{{ gleaned_data.title }}</span></li>
  </ul>
</div>

{# TODO: remove this block? #}
{% if not is_preferred_schedule %}
<div class="alert alert-warning">
  <p>
    <strong>Note:</strong> You specified that the price list you were
    uploading was for <em>{{ preferred_schedule_title }}</em>, but it
    appears to be for <em>{{ gleaned_data.title }}</em>. If this is
    incorrect, please upload a different file.
  </p>
</div>
{% endif %}

{% with rows=gleaned_data.valid_rows %}

  {% with total=rows|length %}
    <h3>{{ total }} row{{ total|pluralize }} ready to add to CALC</h3>
  {% endwith %}

  {{ gleaned_data.to_table|safe }}
{% endwith %}


<form method="post">
  {% csrf_token %}
  <div class="form-button-row clearfix">
    {% if gleaned_data.invalid_rows %}
      <a href="{% url 'data_capture:step_3_errors' %}" class="button button-previous">Previous</a>
    {% else %}
      <a href="{% url 'data_capture:step_3' %}" class="button button-previous">Previous</a>
    {% endif %}

    {% if gleaned_data.valid_rows %}
      <div class="submit-group">
        <button type="submit" class="button-primary">Next</button>
        <span class="submit-label">
          Submit for approval.
        </span>
      </div>
    {% endif %}

    <button type="submit" class="button-link" name="cancel" formnovalidate>Cancel</button>
  </div>
</form>

{% endblock %}
